# Changelog — February 7, 2026

## Fix: AI-generated content not displaying on website

### The Problem
AI content was being generated successfully (via GitHub Actions and generate-all-content.ts)
but was NOT showing on the live website. Two separate issues:

**Issue 1: Development pages (/developments/alegra-xxv etc.)**
- The development page only looked in `src/content/developments/` for content
- But the AI script saves development/project content to `src/content/projects/`
- The file slugs matched perfectly (e.g., `projects/alegra-xxv.json` ↔ feed slug `alegra-xxv`)
- But the page never checked that directory → fell through to basic auto-generated page

**Issue 2: Property pages (/properties/N7911 etc.)**
- The AI content loader (`ai-content-loader.ts`) expected a nested format: `{ content: { heroIntro: ... } }`
- But the newer Torrevieja content files use a flat format: `{ heroIntro: ..., locationSection: ... }`
- The validation `if (parsed.content && parsed.metaTitle)` failed because `parsed.content` was undefined
- Property pages fell back to template-generated content, ignoring 109 AI-generated files

### Files Changed

**`src/app/developments/[slug]/page.tsx`**
- `getEnhancedContent()`: Now checks `src/content/projects/` FIRST, then falls back to
  `src/content/developments/` (only for files with correct nested format like old Miralbo content)
- `getEnhancedSlugs()`: Now includes slugs from `projects/` directory, and only includes
  `developments/` files that have the correct nested format (skips flat-format property files)
- This means 19 Torrevieja project pages + 31 Miralbo development pages now render the
  full "10/10" enhanced page with AI content, FAQs, investment sections, etc.

**`src/lib/ai-content-loader.ts`**
- Added `normalizeFlatContent()` function that converts flat-format files to the nested format
- Updated `loadAIContent()` to detect and handle both formats:
  - Nested: `{ content: { heroIntro: ... } }` → used as-is (old Miralbo files)
  - Flat: `{ heroIntro: ..., metaTitle: ... }` → normalized via `normalizeFlatContent()`
- Also added fallback search by `parsed.reference` field (flat format uses `reference` not `property.ref`)
- This means 109 Torrevieja property pages now show AI-generated content

### Content Architecture (for reference)

```
src/content/
├── projects/           ← Development/project-level AI content (19 files)
│   └── alegra-xxv.json    → Rendered at /developments/alegra-xxv
│                          → Has: projectName, content{}, property{images}
│
├── developments/       ← Property-level AI content (141 files)
│   ├── n7911.json         → Used by /properties/N7911
│   │                      → Flat format: heroIntro, faqs, etc. at top level
│   └── chalet-mir0054.json → Legacy Miralbo (nested format, also used by /developments/)
│
├── builders/           ← Builder profile content (193 files)
├── areas/              ← Area guide content (78 files)
├── golf/               ← Golf course content (12 files)
└── articles/           ← Blog article content (8 files)
```

### How it works now

1. User visits `/developments/alegra-xxv`
   → Page checks `projects/alegra-xxv.json` → FOUND → Renders 10/10 enhanced page ✅

2. User visits `/properties/N7911`
   → Loader finds `developments/n7911.json` → Flat format → Normalized → AI content shown ✅

3. User visits `/developments/gomera-star` (a feed-based development)
   → Checks `projects/gomera-star.json` → FOUND → Renders 10/10 enhanced page ✅

4. User visits `/developments/some-non-torrevieja-dev`
   → No project file → Falls through to feed data → AutoGeneratedDevelopmentPage (as before)

### What's NOT changed
- Content generation scripts (generate-all-content.ts, seo-prompts.ts) — untouched
- Feed parsing (xml-parser.ts, unified-feed-service.ts) — untouched
- GitHub Actions workflow — untouched
- No content was regenerated (no API cost)

### Next steps
- After deploying this fix, verify on the live site that:
  - /developments/alegra-xxv shows the full AI content
  - /properties/N7911 shows AI content (not template)
- Consider generating content for other towns beyond Torrevieja
- Consider updating generate-all-content.ts to output the nested format directly
  (so we don't need the normalizer long-term)
